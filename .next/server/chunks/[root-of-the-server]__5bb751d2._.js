module.exports=[18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},93006,(e,t,a)=>{"use strict";t.exports=e.r(18899).vendored["react-rsc"].ReactServerDOMTurbopackServer},27034,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"registerServerReference",{enumerable:!0,get:function(){return n.registerServerReference}});let n=e.r(93006)},61647,(e,t,a)=>{"use strict";function n(e){for(let t=0;t<e.length;t++){let a=e[t];if("function"!=typeof a)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof a}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"ensureServerEntryExports",{enumerable:!0,get:function(){return n}})},91526,e=>{"use strict";var t=e.i(27034),a=e.i(89660),n=e.i(61647);class r{static instance;static getInstance(){return r.instance||(r.instance=new r),r.instance}async getDashboardMetrics(e){let t=await (0,a.createClient)(),n=new Date,r=e?.start||new Date(n.getFullYear(),n.getMonth(),1),o=e?.end||n,[s,i,l]=await Promise.all([t.from("contacts").select("id, status, engagement_score, added_date"),t.from("opportunities").select("id, stage, value, probability, created_at, actual_close_date"),t.from("conversations").select("id, status, last_active")]),c=s.data||[],u=i.data||[],d=l.data||[],p=c.length,g=c.filter(e=>"active"===e.status||"engaged"===e.status).length,h=c.filter(e=>new Date(e.added_date)>=r&&new Date(e.added_date)<=o).length,v=c.filter(e=>{let t=new Date(e.added_date),a=o.getTime()-r.getTime();return t>=new Date(r.getTime()-a)&&t<r}).length,f=u.length,m=u.filter(e=>!["closed_won","closed_lost"].includes(e.stage)).length,w=u.filter(e=>"closed_won"===e.stage).length,y=u.filter(e=>"closed_lost"===e.stage).length,R=u.filter(e=>!["closed_won","closed_lost"].includes(e.stage)).reduce((e,t)=>e+(parseFloat(t.value)||0)*((t.probability||50)/100),0),_=u.filter(e=>"closed_won"===e.stage).reduce((e,t)=>e+(parseFloat(t.value)||0),0),S=w+y,b=S>0?w/S*100:0,x=d.length,C=d.filter(e=>"active"===e.status).length,D=x>0?d.filter(e=>"pending"!==e.status).length/x*100:0,E=c.length>0?c.reduce((e,t)=>e+(t.engagement_score||50),0)/c.length:50;return{totalContacts:p,activeContacts:g,newContactsThisPeriod:h,contactGrowthRate:Math.round(10*(v>0?(h-v)/v*100:100*(h>0)))/10,totalOpportunities:f,openOpportunities:m,wonOpportunities:w,lostOpportunities:y,totalPipelineValue:Math.round(100*R)/100,wonRevenue:Math.round(100*_)/100,averageDealSize:Math.round(100*(w>0?_/w:0))/100,winRate:Math.round(10*b)/10,totalConversations:x,activeConversations:C,responseRate:Math.round(10*D)/10,averageResponseTime:0,engagementScore:Math.round(E),heatScore:Math.round(E*(b/100+.5))}}async getContactAnalytics(e){let t=await (0,a.createClient)(),{data:n}=await t.from("contacts").select("id, first_name, last_name, status, source, industry, engagement_score, added_date").order("engagement_score",{ascending:!1}),r=n||[],o={};r.forEach(e=>{o[e.status||"unknown"]=(o[e.status||"unknown"]||0)+1});let s={};r.forEach(e=>{s[e.source||"unknown"]=(s[e.source||"unknown"]||0)+1});let i={};r.forEach(e=>{i[e.industry||"unknown"]=(i[e.industry||"unknown"]||0)+1});let l={low:r.filter(e=>40>(e.engagement_score||50)).length,medium:r.filter(e=>(e.engagement_score||50)>=40&&70>(e.engagement_score||50)).length,high:r.filter(e=>(e.engagement_score||50)>=70).length},c=[],u=new Date;for(let e=11;e>=0;e--){let t=new Date(u.getFullYear(),u.getMonth()-e,1),a=new Date(u.getFullYear(),u.getMonth()-e+1,0),n=r.filter(e=>{let n=new Date(e.added_date);return n>=t&&n<=a}).length;c.push({timestamp:t.toISOString(),value:n,label:t.toLocaleDateString("en-US",{month:"short",year:"2-digit"})})}let d=r.slice(0,10).map(e=>({id:e.id,name:`${e.first_name||""} ${e.last_name||""}`.trim()||"Unknown",score:e.engagement_score||50}));return{totalCount:r.length,byStatus:o,bySource:s,byIndustry:i,engagementDistribution:l,growthTrend:c,topEngaged:d}}async getRevenueAnalytics(e){let t=await (0,a.createClient)(),[n,r]=await Promise.all([t.from("opportunities").select("id, title, value, stage, probability, expected_close_date, actual_close_date, product_id, created_at"),t.from("products").select("id, name")]),o=n.data||[],s=new Map((r.data||[]).map(e=>[e.id,e.name])),i=o.filter(e=>"closed_won"===e.stage),l=i.reduce((e,t)=>e+(parseFloat(t.value)||0),0),c=o.filter(e=>!["closed_won","closed_lost"].includes(e.stage)).reduce((e,t)=>e+(parseFloat(t.value)||0)*((t.probability||50)/100),0),u=i.length>0?l/i.length:0,d=[],p=new Date;for(let e=11;e>=0;e--){let t=new Date(p.getFullYear(),p.getMonth()-e,1),a=new Date(p.getFullYear(),p.getMonth()-e+1,0),n=i.filter(e=>{let n=new Date(e.actual_close_date||e.created_at);return n>=t&&n<=a}).reduce((e,t)=>e+(parseFloat(t.value)||0),0);d.push({timestamp:t.toISOString(),value:n,label:t.toLocaleDateString("en-US",{month:"short",year:"2-digit"})})}let g={};i.forEach(e=>{let t=e.product_id?s.get(e.product_id)||"Unknown":"Unassigned";g[t]||(g[t]={revenue:0,count:0}),g[t].revenue+=parseFloat(e.value)||0,g[t].count+=1});let h=Object.entries(g).map(([e,t])=>({product:e,revenue:t.revenue,count:t.count})).sort((e,t)=>t.revenue-e.revenue),v={};return o.forEach(e=>{v[e.stage]=(v[e.stage]||0)+(parseFloat(e.value)||0)}),{totalRevenue:Math.round(100*l)/100,projectedRevenue:Math.round(100*c)/100,averageDealSize:Math.round(100*u)/100,revenueByMonth:d,revenueByProduct:h,revenueByStage:v,forecastAccuracy:85}}async getConversationAnalytics(){let e=await (0,a.createClient)(),{data:t}=await e.from("conversations").select("id, channel, status, last_active"),n=t||[],r={};n.forEach(e=>{r[e.channel||"unknown"]=(r[e.channel||"unknown"]||0)+1});let o={};return n.forEach(e=>{o[e.status||"unknown"]=(o[e.status||"unknown"]||0)+1}),{totalConversations:n.length,byChannel:r,byStatus:o,responseTimeAvg:15,messagesPerConversation:8,conversionRate:35,sentimentDistribution:{positive:45,neutral:40,negative:15}}}async structureDataForAI(e,t){let n=await (0,a.createClient)(),r="",o=[],s=[],i=[],l={};if("contact"===e&&t){let{data:e}=await n.from("contacts").select("*").eq("id",t).single();e&&(r=`Contact: ${e.first_name} ${e.last_name}, ${e.job_title||"Role unknown"} at ${e.company}. 
          Industry: ${e.industry||"Unknown"}. 
          Status: ${e.status}. 
          Engagement Score: ${e.engagement_score||50}/100.
          Interests: ${(e.interests||[]).join(", ")||"None recorded"}.
          Communication Style: ${e.demeanor||"Unknown"}.
          Preferred Channel: ${e.preferred_channel||"Email"}.`,o.push({type:"person",value:`${e.first_name} ${e.last_name}`,confidence:1},{type:"company",value:e.company,confidence:1},{type:"email",value:e.email,confidence:1}),e.industry&&o.push({type:"industry",value:e.industry,confidence:.9}),e.engagement_score&&e.engagement_score>70&&s.push("High engagement contact - prioritize for outreach"),"cold"===e.status&&s.push("Contact has gone cold - consider re-engagement campaign"),"Analytical"===e.demeanor&&i.push("Provide data-driven presentations and ROI calculations"),e.preferred_channel&&i.push(`Prioritize ${e.preferred_channel} for communication`),l=e)}else if("full"===e){let e=await this.getDashboardMetrics(),t=await this.getContactAnalytics(),a=await this.getRevenueAnalytics();r=`Platform Overview:
        - ${e.totalContacts} total contacts (${e.activeContacts} active)
        - ${e.totalOpportunities} opportunities worth $${e.totalPipelineValue.toLocaleString()} in pipeline
        - ${e.wonOpportunities} won deals totaling $${e.wonRevenue.toLocaleString()}
        - ${e.winRate}% win rate
        - ${e.totalConversations} conversations (${e.activeConversations} active)
        - Average engagement score: ${e.engagementScore}/100`,s.push(`Contact growth rate: ${e.contactGrowthRate}%`),s.push(`Win rate: ${e.winRate}%`),s.push(`Average deal size: $${e.averageDealSize.toLocaleString()}`),e.winRate<30&&i.push("Win rate below 30% - review sales process and qualification criteria"),e.contactGrowthRate<5&&i.push("Low contact growth - consider expanding lead generation efforts"),l={metrics:e,contactAnalytics:t,revenueAnalytics:a}}return{context:r,entities:o,relationships:[],insights:s,recommendations:i,structuredData:l}}async collectActivityData(e,t){let n=(await (0,a.createClient)()).from("activities").select("*").order("created_at",{ascending:!1}).limit(100);e&&(n=n.gte("created_at",e.toISOString())),t&&(n=n.lte("created_at",t.toISOString()));let{data:r}=await n;return r||[]}async aggregatePerformanceData(){let e=await this.getDashboardMetrics(),t=[],a=new Date;for(let n=29;n>=0;n--){let r=new Date(a);r.setDate(r.getDate()-n),t.push({timestamp:r.toISOString(),value:Math.floor(20*Math.random())+e.engagementScore-10,label:r.toLocaleDateString("en-US",{month:"short",day:"numeric"})})}let n=[];for(let e=11;e>=0;e--){let t=new Date(a);t.setDate(t.getDate()-7*e),n.push({timestamp:t.toISOString(),value:Math.floor(30*Math.random())+50,label:`Week ${12-e}`})}return{dailyMetrics:t,weeklyTrends:n,topPerformers:[{name:"Email Campaigns",metric:"response_rate",value:42},{name:"LinkedIn Outreach",metric:"connection_rate",value:38},{name:"Cold Calls",metric:"conversion_rate",value:12}]}}async generateReport(e,t){let a=new Date,n=t?.startDate||a,r=t?.endDate||a;switch(e){case"daily":n=new Date(a.setHours(0,0,0,0)),r=new Date(a.setHours(23,59,59,999));break;case"weekly":n=new Date(a.setDate(a.getDate()-7)),r=new Date;break;case"monthly":n=new Date(a.getFullYear(),a.getMonth(),1),r=new Date(a.getFullYear(),a.getMonth()+1,0)}let o={start:n,end:r,granularity:"daily"===e?"hour":"weekly"===e?"day":"week"},[s,i,l]=await Promise.all([this.getDashboardMetrics(o),this.getContactAnalytics(o),this.getRevenueAnalytics(o)]),c=[],u=[];s.contactGrowthRate>10&&c.push(`Strong contact growth of ${s.contactGrowthRate}% this period`),s.winRate>40&&c.push(`Above-average win rate of ${s.winRate}%`),s.totalPipelineValue>0&&c.push(`$${s.totalPipelineValue.toLocaleString()} in weighted pipeline value`),s.responseRate<50&&u.push("Improve response rate by implementing follow-up automation"),s.engagementScore<60&&u.push("Boost engagement with personalized outreach campaigns"),l.projectedRevenue<.8*l.totalRevenue&&u.push("Pipeline may need attention - projected revenue below target");let d=`This ${e} report covers ${s.totalContacts} contacts with ${s.newContactsThisPeriod} new additions. 
      Revenue performance shows $${s.wonRevenue.toLocaleString()} closed with $${s.totalPipelineValue.toLocaleString()} in pipeline. 
      Win rate stands at ${s.winRate}% with an average deal size of $${s.averageDealSize.toLocaleString()}.`;return{title:`${e.charAt(0).toUpperCase()+e.slice(1)} Performance Report`,generatedAt:new Date().toISOString(),period:{start:n.toISOString(),end:r.toISOString()},summary:d,metrics:s,contactAnalytics:i,revenueAnalytics:l,insights:c,recommendations:u}}}let o=r.getInstance(),s=async e=>o.getDashboardMetrics(e),i=async e=>o.getContactAnalytics(e),l=async e=>o.getRevenueAnalytics(e),c=async()=>o.getConversationAnalytics(),u=async(e,t)=>o.structureDataForAI(e,t),d=async(e,t)=>o.generateReport(e,t),p=async()=>o.aggregatePerformanceData();(0,n.ensureServerEntryExports)([s,i,l,c,u,d,p]),(0,t.registerServerReference)(s,"40a2e1c78562de6fe8e1b2489caa6dd38b16cc9771",null),(0,t.registerServerReference)(i,"40c9172ffe9af6a81acecee9235420a0d4ac5ee08f",null),(0,t.registerServerReference)(l,"40903e783929631e40c8d3a7386e808ce730cb8b1c",null),(0,t.registerServerReference)(c,"003408c3d42965ff540960b80134e63a9c88402e3b",null),(0,t.registerServerReference)(u,"6079d8a200930633eaed0f67d1c480aeb030819154",null),(0,t.registerServerReference)(d,"60928c4328c04c29edfa684dbd5c42234debe98a1c",null),(0,t.registerServerReference)(p,"000fe66f033fee91e8d43842a8f38f97ab7111a20f",null),e.s(["generateReport",0,d,"getContactAnalytics",0,i,"getConversationAnalytics",0,c,"getDashboardMetrics",0,s,"getRevenueAnalytics",0,l])},14361,e=>{"use strict";var t=e.i(5246),a=e.i(9381),n=e.i(53516),r=e.i(88513),o=e.i(6151),s=e.i(50059),i=e.i(66602),l=e.i(52444),c=e.i(14694),u=e.i(49691),d=e.i(7726),p=e.i(34583),g=e.i(41813),h=e.i(36356),v=e.i(65931),f=e.i(93695);e.i(94173);var m=e.i(51092),w=e.i(44064),y=e.i(91526);async function R(e){try{let t=e.nextUrl.searchParams.get("type")||"monthly",a=await (0,y.generateReport)(t);return w.NextResponse.json(a)}catch(e){return console.error("[Thorne Neural Network] Report generation error:",e),w.NextResponse.json({success:!1,error:"Failed to generate report"},{status:500})}}e.s(["GET",()=>R],52723);var _=e.i(52723);let S=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/analytics/report/route",pathname:"/api/analytics/report",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/analytics/report/route.ts",nextConfigOutput:"",userland:_}),{workAsyncStorage:b,workUnitAsyncStorage:x,serverHooks:C}=S;function D(){return(0,n.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:x})}async function E(e,t,n){S.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/analytics/report/route";w=w.replace(/\/index$/,"")||"/";let y=await S.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:R,params:_,nextConfig:b,parsedUrl:x,isDraftMode:C,prerenderManifest:D,routerServerContext:E,isOnDemandRevalidate:$,revalidateOnlyGenerated:A,resolvedPathname:P,clientReferenceManifest:k,serverActionsManifest:M}=y,O=(0,i.normalizeAppPath)(w),T=!!(D.dynamicRoutes[O]||D.routes[P]),I=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,x,!1):t.end("This page could not be found"),null);if(T&&!C){let e=!!D.routes[P],t=D.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await I();throw new f.NoFallbackError}}let j=null;!T||S.isDev||C||(j="/index"===(j=P)?"/":j);let N=!0===S.isDev||!T,U=T&&!N;M&&k&&(0,s.setManifestsSingleton)({page:w,clientReferenceManifest:k,serverActionsManifest:M});let F=e.method||"GET",q=(0,o.getTracer)(),H=q.getActiveScopeSpan(),L={params:_,prerenderManifest:D,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:N,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n,r)=>S.onRequestError(e,t,n,r,E)},sharedContext:{buildId:R}},z=new l.NodeNextRequest(e),G=new l.NodeNextResponse(t),K=c.NextRequestAdapter.fromNodeNextRequest(z,(0,c.signalFromNodeResponse)(t));try{let s=async e=>S.handle(K,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=q.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${F} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${w}`)}),i=!!(0,r.getRequestMeta)(e,"minimalMode"),l=async r=>{var o,l;let c=async({previousCacheEntry:a})=>{try{if(!i&&$&&A&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(r);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let c=L.renderOpts.collectedTags;if(!T)return await (0,p.sendResponse)(z,G,o,L.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(o.headers);c&&(t[v.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,n=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==a?void 0:a.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:$})},!1,E),t}},u=await S.handleResponse({req:e,nextConfig:b,cacheKey:j,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:D,isRoutePPREnabled:!1,isOnDemandRevalidate:$,revalidateOnlyGenerated:A,responseGenerator:c,waitUntil:n.waitUntil,isMinimalMode:i});if(!T)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",$?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,g.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&T||f.delete(v.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(z,G,new Response(u.value.body,{headers:f,status:u.value.status||200})),null};H?await l(H):await q.withPropagatedContext(e.headers,()=>q.trace(u.BaseServerSpan.handleRequest,{spanName:`${F} ${w}`,kind:o.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:$})},!1,E),T)throw t;return await (0,p.sendResponse)(z,G,new Response(null,{status:500})),null}}e.s(["handler",()=>E,"patchFetch",()=>D,"routeModule",()=>S,"serverHooks",()=>C,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>x],14361)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5bb751d2._.js.map