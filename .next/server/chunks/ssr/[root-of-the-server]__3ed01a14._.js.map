{"version":3,"sources":["../../../../node_modules/.pnpm/next%4016.1.5_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.4_react%4019.2.4__react%4019.2.4/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/.pnpm/next%4016.1.5_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.4_react%4019.2.4__react%4019.2.4/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../app/actions/stripe.ts","../../../../lib/subscription-products.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","\"use server\"\n\nimport { getStripe } from \"@/lib/stripe\"\nimport { createClient } from \"@/lib/supabase/server\"\nimport { SUBSCRIPTION_PLANS, getPlanById } from \"@/lib/subscription-products\"\nimport Stripe from \"stripe\"\n\nconst stripe = getStripe()\n\nexport async function createCheckoutSession(params: {\n  planId: string\n  seatCount: number\n  tenantName: string\n  email: string\n  successUrl: string\n  cancelUrl: string\n}) {\n  const plan = getPlanById(params.planId)\n  if (!plan) {\n    return { error: \"Invalid plan selected\" }\n  }\n\n  if (params.seatCount > plan.maxSeats) {\n    return { error: `Maximum ${plan.maxSeats} seats allowed for ${plan.name} plan` }\n  }\n\n  try {\n    const stripe = getStripe()\n    // Create checkout session with per-seat pricing\n    const session = await stripe.checkout.sessions.create({\n      mode: \"subscription\",\n      payment_method_types: [\"card\"],\n      customer_email: params.email,\n      line_items: [\n        {\n          price_data: {\n            currency: \"usd\",\n            product_data: {\n              name: `${plan.name} Plan`,\n              description: `${params.seatCount} seat(s) - ${plan.description}`,\n            },\n            unit_amount: plan.pricePerSeatCents,\n            recurring: {\n              interval: \"month\",\n            },\n          },\n          quantity: params.seatCount,\n        },\n      ],\n      metadata: {\n        planId: params.planId,\n        seatCount: params.seatCount.toString(),\n        tenantName: params.tenantName,\n        email: params.email,\n      },\n      subscription_data: {\n        metadata: {\n          planId: params.planId,\n          seatCount: params.seatCount.toString(),\n          tenantName: params.tenantName,\n        },\n      },\n      success_url: params.successUrl,\n      cancel_url: params.cancelUrl,\n    })\n\n    return { sessionId: session.id, url: session.url }\n  } catch (error) {\n    console.error(\"[v0] Stripe checkout error:\", error)\n    return { error: \"Failed to create checkout session\" }\n  }\n}\n\nexport async function createBillingPortalSession(customerId: string, returnUrl: string) {\n  try {\n    const stripe = getStripe()\n    const session = await stripe.billingPortal.sessions.create({\n      customer: customerId,\n      return_url: returnUrl,\n    })\n    return { url: session.url }\n  } catch (error) {\n    console.error(\"[v0] Billing portal error:\", error)\n    return { error: \"Failed to create billing portal session\" }\n  }\n}\n\nexport async function updateSubscriptionSeats(subscriptionId: string, newSeatCount: number) {\n  try {\n    const stripe = getStripe()\n    const subscription = await stripe.subscriptions.retrieve(subscriptionId)\n    const itemId = subscription.items.data[0]?.id\n\n    if (!itemId) {\n      return { error: \"Subscription item not found\" }\n    }\n\n    await stripe.subscriptions.update(subscriptionId, {\n      items: [\n        {\n          id: itemId,\n          quantity: newSeatCount,\n        },\n      ],\n      proration_behavior: \"create_prorations\",\n    })\n\n    return { success: true }\n  } catch (error) {\n    console.error(\"[v0] Update seats error:\", error)\n    return { error: \"Failed to update subscription seats\" }\n  }\n}\n","export interface SubscriptionPlan {\n  id: string\n  name: string\n  description: string\n  pricePerSeatCents: number\n  features: string[]\n  maxSeats: number\n  stripePriceId?: string\n}\n\n// Per-seat pricing plans\nexport const SUBSCRIPTION_PLANS: SubscriptionPlan[] = [\n  {\n    id: \"starter\",\n    name: \"Starter\",\n    description: \"Perfect for small teams getting started\",\n    pricePerSeatCents: 2900, // $29/seat/month\n    features: [\n      \"Up to 500 contacts\",\n      \"Basic AI assistance\",\n      \"Email integration\",\n      \"Standard support\",\n    ],\n    maxSeats: 5,\n  },\n  {\n    id: \"professional\",\n    name: \"Professional\",\n    description: \"For growing teams that need more power\",\n    pricePerSeatCents: 7900, // $79/seat/month\n    features: [\n      \"Up to 5,000 contacts\",\n      \"Advanced AI with Thorne\",\n      \"Multi-channel outreach\",\n      \"Priority support\",\n      \"Custom workflows\",\n    ],\n    maxSeats: 25,\n  },\n  {\n    id: \"enterprise\",\n    name: \"Enterprise\",\n    description: \"Full power for large organizations\",\n    pricePerSeatCents: 14900, // $149/seat/month\n    features: [\n      \"Unlimited contacts\",\n      \"Full Thorne AI suite\",\n      \"All integrations\",\n      \"Dedicated support\",\n      \"Custom training\",\n      \"API access\",\n    ],\n    maxSeats: 100,\n  },\n]\n\nexport function getPlanById(planId: string): SubscriptionPlan | undefined {\n  return SUBSCRIPTION_PLANS.find((p) => p.id === planId)\n}\n\nexport function formatPrice(cents: number): string {\n  return new Intl.NumberFormat(\"en-US\", {\n    style: \"currency\",\n    currency: \"USD\",\n  }).format(cents / 100)\n}\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1]}