{"version":3,"sources":["../../../../node_modules/.pnpm/next%4016.1.5_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.4_react%4019.2.4__react%4019.2.4/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/.pnpm/next%4016.1.5_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.4_react%4019.2.4__react%4019.2.4/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../app/actions/signup-checkout.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","'use server'\n\nimport { getStripe } from '@/lib/stripe'\n\nexport async function createSignupCheckoutSession(params: {\n  email: string\n  username: string\n  userId: string\n  companyName: string\n  planId?: string\n  seatCount?: number\n  monthlyPrice?: number\n}) {\n  const { \n    email, \n    username, \n    userId, \n    companyName,\n    planId = 'agyntsync',\n    seatCount = 1,\n    monthlyPrice = 249\n  } = params\n  \n  const stripe = getStripe()\n\n  // Create or get customer\n  const customers = await stripe.customers.list({ email, limit: 1 })\n  let customerId: string\n\n  if (customers.data.length > 0) {\n    customerId = customers.data[0].id\n  } else {\n    const customer = await stripe.customers.create({\n      email,\n      metadata: {\n        username,\n        userId,\n        companyName,\n      },\n    })\n    customerId = customer.id\n  }\n\n  // Determine product name based on plan\n  const productName = planId === 'agyntsync' \n    ? `AgyntSync Neural Bundle${seatCount > 1 ? ` (${seatCount} seats)` : ''}`\n    : `Agyntos Standard${seatCount > 1 ? ` (${seatCount} seats)` : ''}`\n\n  // Create checkout session with subscription\n  const session = await stripe.checkout.sessions.create({\n    customer: customerId,\n    ui_mode: 'embedded',\n    redirect_on_completion: 'never',\n    line_items: [\n      // Monthly subscription based on selected plan and seats\n      {\n        price_data: {\n          currency: 'usd',\n          product_data: {\n            name: productName,\n            description: `Monthly subscription to ${planId === 'agyntsync' ? 'AgyntSync' : 'Agyntos'} platform with ${seatCount} user seat${seatCount > 1 ? 's' : ''}`,\n          },\n          unit_amount: monthlyPrice * 100, // Convert to cents\n          recurring: {\n            interval: 'month',\n          },\n        },\n        quantity: 1,\n      },\n    ],\n    mode: 'subscription',\n    subscription_data: {\n      metadata: {\n        username,\n        userId,\n        planId,\n        seatCount: seatCount.toString(),\n      },\n    },\n    metadata: {\n      username,\n      userId,\n      type: 'signup',\n      tenantName: companyName,\n      planId,\n      seatCount: seatCount.toString(),\n      email,\n    },\n  })\n\n  return {\n    clientSecret: session.client_secret,\n    sessionId: session.id,\n  }\n}\n\nexport async function getCheckoutSessionStatus(sessionId: string) {\n  const stripe = getStripe()\n  const session = await stripe.checkout.sessions.retrieve(sessionId)\n\n  return {\n    status: session.status,\n    paymentStatus: session.payment_status,\n    customerEmail: session.customer_details?.email,\n  }\n}\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"gXAAoD,OAAA,cAAA,CAAA,EAAA,aAAA,oCAC3CA,0BAAAA,qCAAAA,EAAAA,uBAAuB,YAAQ,CAAA,CAAA,IAAA,iCCEjC,SAASC,EAAyBC,CAAc,EACrD,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAQE,MAAM,CAAED,IAAK,CACvC,IAAME,EAASH,CAAO,CAACC,EAAE,CACzB,GAAI,AAAkB,YAAY,OAAvBE,EACT,MAAM,OAAA,cAEL,CAFK,AAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,EAAO;AAAA,oEAAuE,CAAC,EADhJ,oBAAA,OAAA,mBAAA,gBAAA,CAEN,EAEJ,CACF,0EATgBJ,2BAAAA,qCAAAA,8CCDhB,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAA4B,CAQjD,EACC,IAcI,EAdE,OACJ,CAAK,UACL,CAAQ,QACR,CAAM,aACN,CAAW,QACX,EAAS,WAAW,WACpB,EAAY,CAAC,cACb,EAAe,GAAG,CACnB,CAAG,EAEE,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAGlB,EAAY,MAAM,EAAO,SAAS,CAAC,IAAI,CAAC,OAAE,EAAO,MAAO,CAAE,GAI9D,EADE,EAAU,IAAI,CAAC,MAAM,CAAG,EACb,CADgB,CACN,IAAI,CAAC,EAAE,CAAC,EAAE,CAUpB,CARI,MAAM,EAAO,SAAS,CAAC,MAAM,CAAC,OAC7C,EACA,SAAU,UACR,SACA,cACA,CACF,CACF,EAAA,EACsB,EAAE,CAI1B,IAAM,EAAc,AAAW,gBAC3B,CAAC,uBAAuB,EAAE,EAAY,EAAI,CAAC,EAAE,EAAE,EAAU,OAAO,CAAC,CAAG,GAAA,CAAI,CACxE,CAAC,gBAAgB,EAAE,EAAY,EAAI,CAAC,EAAE,EAAE,EAAU,OAAO,CAAC,CAAG,GAAA,CAAI,CAG/D,EAAU,MAAM,EAAO,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,CACpD,SAAU,EACV,QAAS,WACT,uBAAwB,QACxB,WAAY,CAEV,CACE,WAAY,CACV,SAAU,MACV,aAAc,CACZ,KAAM,EACN,YAAa,CAAC,wBAAwB,EAAa,cAAX,EAAyB,YAAc,UAAU,eAAe,EAAE,EAAU,UAAU,EAAE,EAAY,EAAI,IAAM,GAAA,CAAI,AAC5J,EACA,YAA4B,IAAf,EACb,UAAW,CACT,SAAU,OACZ,CACF,EACA,SAAU,CACZ,EACD,CACD,KAAM,eACN,kBAAmB,CACjB,SAAU,UACR,SACA,SACA,EACA,UAAW,EAAU,QAAQ,EAC/B,CACF,EACA,SAAU,UACR,SACA,EACA,KAAM,SACN,WAAY,SACZ,EACA,UAAW,EAAU,QAAQ,GAC7B,OACF,CACF,GAEA,MAAO,CACL,aAAc,EAAQ,aAAa,CACnC,UAAW,EAAQ,EAAE,AACvB,CACF,CAEO,eAAe,EAAyB,CAAiB,EAC9D,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAU,MAAM,EAAO,QAAQ,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAExD,MAAO,CACL,OAAQ,EAAQ,MAAM,CACtB,cAAe,EAAQ,cAAc,CACrC,cAAe,EAAQ,gBAAgB,EAAE,KAC3C,CACF,0CArGsB,EA4FA,IA5FA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MA4FA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA","ignoreList":[0,1]}